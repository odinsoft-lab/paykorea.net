# 국내 PG 연동 통합 결제 SDK 개발 계획서

대상: C#(.NET) 개발자용 / 국내 결제 전용(카드+간편결제)

------------------------------------------------------------------------

## 0) 제품 목표 & 범위 (Option B: SDK-온리)

-   목표: C# 개발자가 국내 PG(토스페이먼츠, KG이니시스, KCP 등)와 간편결제(카카오/네이버/애플/삼성)를 한 번의 SDK로 손쉽게 연동.

-   범위(MVP)
    1) PG 2곳(1순위: 토스페이먼츠, 2순위: 이니시스) 어댑터 제공
    2) 브라우저 Redirect/Popup 기반 결제 플로우를 SDK가 보조(각 PG 가이드 준수)
    3) 결제 생성/승인/취소/부분환불/영수증/웹훅 서명 검증 유틸리티
    4) 애플페이(웹) 머천트 검증 프록시 템플릿 제공(승인은 PG 경유)
    5) 간편결제 라우팅 헬퍼(카카오/네이버 등 PG 창 옵션 구성)
    6) SDK: `PayKorea.Net`(C#/.NET 8) + 샘플/템플릿(ASP.NET Core: 웹훅 검증/애플페이 검증)

    참고) 호스티드 체크아웃/SaaS 제공은 포함하지 않음. 웹훅은 머천트 자사 서버가 직접 수신/검증.

------------------------------------------------------------------------

## 1) 아키텍처 개요

```
[머천트 애플리케이션]
    ├─ (Client) 브라우저: Redirect/Popup → 각 PG 결제 화면 이동
    ├─ (Server) ASP.NET Core (샘플/템플릿)
    │        ├─ Webhook 검증 핸들러(서명검증/멱등 처리) 템플릿
    │        └─ Apple Pay 머천트 검증 프록시 템플릿
    └─ (Lib) NuGet SDK: PayKorea.Net
             ├─ ProviderAdapter: Toss, KG Inicis, (KCP/NICE 추가)
             └─ Wallet Helper: Kakao/Naver/Apple/Samsung 라우팅 옵션 구성
```

- 호스티드 체크아웃/SaaS 없음. 모든 콜백/웹훅은 머천트 서버에서 처리.

------------------------------------------------------------------------

## 2) 기술 스택

-   SDK: .NET 8 / C# 12, `PayKorea.Net`
-   샘플/템플릿: ASP.NET Core Minimal API
    - Webhook 서명 검증/멱등/재시도 처리 예제
    - Apple Pay 머천트 검증 프록시 예제
-   도구/품질: Serilog(선택), OpenTelemetry(선택), Polly(재시도 유틸)
-   CI/CD: GitHub Actions(빌드/테스트/패키징/NuGet 배포)
-   테스트: xUnit + WireMock.NET(외부 PG 모킹), k6(부하, 선택)
